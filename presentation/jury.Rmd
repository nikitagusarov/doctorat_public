---
title: "Performances des modèles économétriques et de Machine Learning pour l'étude économique des choix discrets de consommation"
subtitle: |
    | Projet Doctoral
    | *Contribution méthodologique en économie et économétrie appliquée*
# subtitle: "Exploration of the Econometrics and Machine Learning model performances in the presence of heterogeneous preferences and random effects utilities"
date: 01/09/2020
author: |
    | \large Nikita Gusarov
    | \small Master 2, MIASHS C2ES (UGA)
    | 
    | \raggedright\small Directeur de thèse: 
    | \raggedright\hspace{10mm}\small Iragaël Joly, MCF HDR (GAEL, UGA, Grenoble INP)
    | \raggedright\small Co-encadrant:
    | \raggedright\hspace{10mm}\small Pierre Lemaire, MCF (G-SCOP, Grenoble INP)
    | \hspace{-20mm}
output: 
    beamer_presentation:
        # latex_engine: "lualatex"
        theme: "Montpellier"
        colortheme: "beaver"
        df_print: "kable"
        slide_level: 2
        fig_width: 4.2
        fig_height: 2.5
        fig_caption: TRUE
        includes:
            in_header: ../auxilary/header_jury.tex
# Fonts as recommended in guidelines
# Works only with lualatex engine
# XITS is one of the analogs for proprietary Times New Roman
fontsize: 11pt 
# mainfont: XITS 
# linestretch: 1.15 # This is standard for Word Documents (MS Word 2007, 2010, 2016)
# Add autogenerated bibentry for r packages
bibliography: 
    - ../litterature/bibliographie.bib 
    - ../litterature/bibliographie_sup.bib
---





```{r Knitr, echo = FALSE}
#################
# Knitr options #
#################

knitr::opts_chunk$set(
    fig.align = "center",
    echo = FALSE,
    warning = FALSE
    # dev = "tikz"
)
```

```{r Packages, echo= FALSE, include = FALSE}
####################
# PAckages and AUX #
####################

# General document wide packages
library(tidyverse)
library(ggpubr)
```

# Introduction

## Approche scientifique en économie & économétrie

<!-- En sciences économiques et économétrie de modelisation du choix individuel une \textcolor{red}{approche scientifique traditionnelle} incorpore: -->
<!-- C'est une des apporches en économie sovent appliquées en économie pour les études de consommation  -->

\begin{figure}
    \centering
    \label{fig:burel}
    \begin{tikzpicture}[
        box/.style = {
            draw, 
            text width=2cm, 
            align=center, 
            minimum width={width("économétrique")+2pt},
            minimum height={1cm},
            font=\small
        },node distance=1.8cm]

        \node[box] (b) {Modèle\\théorique};
        \node[box, left=of b] (a) {Question\\économique};
        \node[box, below=of b] (c) {Collecte\\des données};
        \node[box, below=of a] (d) {Estimation\\économétrique};
        
        \draw[->] (a) -- (b) node[midway, above] {\textit{\scriptsize Variables}};
        \draw[->] (b) -- (c);
        \draw[->] (c) -- (d) node[midway, below] {\textit{\scriptsize Données}};
        \draw[dashed, ->] (d) -- (a) node[midway, left] {\textit{\scriptsize Réponse}};
    \end{tikzpicture}
\end{figure}

[@hensher2015]

## Exemple 

@llerena2013rose étudient **les consentements à payer pour les attributs environnementaux des produits non-alimentaires** (*des roses rouges*)

\begin{figure}
    \centering
    \label{fig:burel}
    \begin{tikzpicture}[
        box/.style = {
            draw, 
            text width=2.5cm, 
            align=center, 
            minimum width={width("Expérimentation")+4pt},
            minimum height={1cm},
            font=\small
        },node distance=1.8cm]

        \node[box] (b) {\textcolor{red}{Maximisation d'Utilité (RUM)}};
        \node[box, left=of b] (a) {Consentements\\à payer};
        \node[box, below=of b] (c) {Expérimentation};
        \node[box, below=of a] (d) {\textcolor{red}{Logit Mixte (MMNL)}};
        
        \draw[->] (a) -- (b) node[midway, above] {\textit{\scriptsize Variables}};
        \draw[->] (b) -- (c);
        \draw[->] (c) -- (d) node[midway, below] {\textit{\scriptsize Données}};
        \draw[dashed, ->] (d) -- (a) node[midway, left] {\textit{\scriptsize Réponse}};
    \end{tikzpicture}
\end{figure}


<!-- Aurait-on eu de meilleurs résultats avec un NN? -->


## Mise en perspective - Revue de Littérature

<!-- Méthodes quantitatives -->

+ Questions sur l'**outil**
  - Performances comparées des \textcolor{red}{modèles de l'IA et du ML} avec les \textcolor{red}{modèles économétriques} traditionnels [@mihalovic2016performance]?
+ Questions sur l'**usage** de l'outil
  - Quelle taille d'\textcolor{red}{échantillon} choisir pour une puissance statistique donnée [@ye2014comparing]?
  - Quelle \textcolor{red}{structure} de la base des données? Quelle méthode de \textcolor{red}{collecte des données} [@mannering2014analytic]?
+ Questions d'**intégration** de l'outil dans l'**approche économique**
  - Quelle \textcolor{red}{validité externe} des résultats [@horvathova2020comparison]?
  - Les modèles de \textcolor{red}{machine learning} peuvent-ils être adaptés pour traiter des questions économiques [@varian2014bd]

## Objectif 

**Question de recherche**:

\begin{center}
\Large 
\textit{L'étude économique des \textcolor{red}{choix discrets de consommation} à travers la \textcolor{red}{comparaison de performance des modèles} économétriques et des outils de l'IA et du ML}
\normalsize
\end{center}

# Méthodologie

## Le *framework* proposé

\begin{figure}
    \centering
    \label{fig:burel}
    \begin{tikzpicture}[
        box/.style = {
            draw, 
            text width=2cm, 
            align=center, 
            minimum width={width("Interpretation")+2pt},
            minimum height={1.2cm},
            font=\scriptsize
        },node distance=1.8cm]

        \node[box] (b) {Modèle\\théorique};
        \node[box, left=of b] (a) {Question\\économique};
        \node[box, right=of b] (c) {Design\\expérimental};
        \node[box, below=of c] (d) {Estimation\\économétrique};
        \node[box, below=of b] (e) {Evaluation\\des\\performances};
        \node[box, below=of a] (f) {Interprétation\\des\\indicateurs};

        \node[rectangle, draw=red, fit=(b) (c), inner sep=1mm, label=above:{\textcolor{red}{Simulation}}] (bc) {};
        \node[rectangle, draw=red, fit=(e) (f), inner sep=1mm, label=above:{\textcolor{red}{Comparison}}] (ef) {};
        
        \draw[->] (a) -- (b) node[midway, above] {\textit{\scriptsize Variables}};
        \draw[->] (b) -- (c) node[midway, above] {\textit{\scriptsize Modèle}};
        \draw[->] (c) -- (d) node[midway, right] {\textit{\scriptsize Données}};
        \draw[->] (d) -- (e) node[midway, below] {\textit{\scriptsize Résultats}};
        \draw[->] (e) -- (f) node[midway, below] {\textit{\scriptsize Mesures}};
        \draw[dashed, ->] (f) -- (a) node[midway, left] {\textit{\scriptsize Réponse}};
    \end{tikzpicture}
\end{figure}

## Travail antérieur - Master 2

**Question étudiée:**

\begin{center}
Performances de modèles économétriques \textcolor{red}{multinomiaux} comparés au \textcolor{red}{réseau de neurones} en présence de \textcolor{red}{préférences hétérogènes} des consommateurs ?
\end{center}

## Travail antérieur - Master 2

<!-- - Construction des \textcolor{red}{deux jeux des données artificielles} permettant de controller la presence des \textcolor{red}{preferences heterogénes} ou \textcolor{red}{homogenes} dans la population 
- Estimation des \textcolor{red}{trois modèles} issues de l'*économétrie* et du *machine learning* sur les deux jeux de données 
- Evaluation des \textcolor{red}{performances des modèles} sur les deux jeux de données par plusieurs critéres -->

- Un *framework* permettant de \textcolor{red}{tester les hypothèses et théories}
    - \textcolor{red}{Deux} jeux des données artificielles  : \newline préférences \textcolor{red}{hétérogènes} vs.  \textcolor{red}{homogènes}
    - \textcolor{red}{Trois} modèles issus de l'*économétrie* et du *machine learning*
        - Logit multinomial et Logit mixte 
        - Réseau de Neurones Convolutif 
- Evaluation des \textcolor{red}{performances} des modèles
    - Production des indicateurs économiques 
    - Précision
        - Prédiction 
        - Ajustement
    - Efficience en ressources 
- \textcolor{red}{Une grille d'analyse} opérationelle 

<!-- Dire  combien des indicateurs de performances on a utilisé - résultat 2 -->


<!-- résultat 3 - réplication et réproducibilité -->


<!-- Theoretiques: 

- Un *framework* permettant de \textcolor{red}{tester les théories} était conçu
- Un outil de \textcolor{red}{simulation des données} a été créé

Appliqués: 

- La procedure de recherche a été simulé en supposant differents specifications des \textcolor{red}{préférences individuelles} 
- Trois \textcolor{red}{modèles differents} issues des champs statistiques disctincts on été testés et comparés 
    * Modèles \textcolor{red}{économétriques} (MNL et MMNL)
    * Modèles de *\textcolor{red}{machine learning}* (CNN approximation du MNL)
- Les \textcolor{red}{differences des performances} des modèles ont été étudiés  -->

<!--  -->

## Un framework adapté pour étudier:

### Structure des règles de décision de consommation

<!-- Rélier cela avec les champs d'application - transport  -->

- Comment les \textcolor{red}{régles de décision} affectent les estimations?
    - *Random Utility Maximisation* (RUM)
    - *Random Regret Minimisation* (RRM)
    - *Quantum Decision Theory* (QDT)
- Comment les modèles se comportent face à  différentes \textcolor{red}{structures des préférences}? 
    - Hypothèse d'Indépendance aux Alternatives non Pertinentes (IIA) vs dépendance à l'alternative de référence
    - Hypothèse d'utilité additive vs multiplicative

Est-ce que les modèles de *machine learning* sont compatibles avec la \textcolor{red}{microéconomie}?

## Un framework adapté pour étudier:

### Spécification des préférences

<!-- Mentionner ici les applications en tarifcation, énérgie, transport  -->

- Niveau de l'\textcolor{red}{individu}
    - Aversion au risque 
    - Transitivité des préférences
    - *autres apports de la behavioral economics*
- Niveau de la \textcolor{red}{population}
    - Hétérogénéité des préférences
    - Hétérogénéité des règles de décision & niveaux de rationnalité
    
### Opportunité
 - Confronter & rechercher les \textcolor{red}{complémentarités} entre
   + Données de **simulation** et données de l'**expérimentation**
   + Outils du **ML** et modèles **économétriques**

## Contributions de la thèse

- Un \textcolor{red}{outil d'aide à la conception} des études économiques et aux expérimentations
- \textcolor{red}{Publications}
    - Etude des performances en présence des préférences hétérogènes à *DA2PL* à Trento le 5-6 novembre 2020
    - 2 autres *working-papers*, par ex.: 
        - RUM vs RRM 
        - Simulation et expérimentation 
- Un \textcolor{red}{package \textit{R}} permettant de simuler des données de choix de consommation selon différents modèles  comportementaux paramétrables

# Organisation 

## Collaboration et *reproducible research*

<!-- Faire des boules / schema 

- Collaboration sur la base des \textcolor{red}{outils \texit{open-source}} lors du developpement du *framework*
    * *GitHub* 
    * CRAN *R* project 
- Une collaboration avec l'\textcolor{red}{école polytéchnique de Montréal} (invitation de Bruno Agard, Laboratoire en Itelligence des données)
- \textcolor{red}{Codiréction de la thèse} par Pierre Lemaire, laboraoire *G-SCOP* à Grenoble INP  -->

<!-- \smartdiagram[bubble diagram]{PhD et context, Collaboration G-SCOP, Collaboration Montréal, Collaboration open-source, \textit{Collaboration Lausanne}, \textit{Collaboration Leeds}} -->
\begin{figure}
    \centering
\begin{tikzpicture}
\tikzset{
    sun/.style={
        circle,
        color = black!70,
        fill = black!15,
        minimum size = 1cm,
        font = \small,
        inner sep = 0.1cm
    }
}
\tikzset{
    satellite/.style={
        rectangle,
        color = black!70,
        font = \scriptsize,
        minimum size = 1cm,
        inner sep = 0.1cm
    }
}
\tikzset{
    legend/.style={
        rectangle,
        color = black!70,
        font = \tiny,
        minimum size = 1cm,
        inner sep = 0.1cm,
        minimum width={width("En projet")+2pt},
        minimum height={0.8cm}
    }
}
\tikzset{
    satellitearrow/.style={
        -latex,
        line width = 0.15cm
    }
}

\draw (0,0) node (frame) [shape=regular polygon, regular polygon sides=5, minimum size=6cm, rotate=-36] {};

\node (sun) at (frame.center) [sun] {\makecell{PhD\\collaboration}};

\node (satellitea)  at (3,2) [satellite, fill=blue!20] 
    {\makecell{École Polytechnique de Montréal\\\textit{Bruno Agard}\\Machine Learning expert}};
\node (satelliteb)  at (-4, -1) [satellite, fill=blue!20] 
    {\makecell{G-SCOP\\\textit{Pierre Lemaire}\\Informatique et DataScience\\Simulation des données}};
\node (satellitec)  at (frame.corner 2) [satellite, fill=blue!20] 
    {\makecell{Open-source\\\textit{GitHub}\\Reproducibilité}};

\node (satellited)  at (0, -2.5) [satellite, fill=red!20] 
    {\makecell{École polytechnique fédérale de Lausanne\\\textit{Michel Bierlaire}\\Modèles de choix discret}};
\node (satellitee)  at (3.5, -1) [satellite, fill=red!20] 
    {\makecell{Université de Leeds\\Choice Modeling Center\\\textit{Stephane Hess}}};

\node (leg1) at (-5, 2) [legend, fill=blue!20] {Validé};
\node (leg2) at (-5, 1) [legend, fill=red!20] {En projet}; 
\node[rectangle, draw=black, fit=(leg1) (leg2), inner sep=1mm, label=above:{Legend}] (leg1leg2) {};

\draw [satellitearrow, draw=blue!50]  (sun) -- (satellitea);
\draw [satellitearrow, draw=blue!50]    (sun) -- (satelliteb);
\draw [satellitearrow, draw=blue!50]   (sun) -- (satellitec);
\draw [satellitearrow, draw=red!50]     (sun) -- (satellited);
\draw [satellitearrow, draw=red!50]  (sun) -- (satellitee);
\end{tikzpicture}
\end{figure}

## Le plan de travail

```{r ggplot2_gannt, include = FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(scales)
library(Cairo)
library(plotly)
library(zoo)
library(showtext)

# Add fonts
font_add_google("Source Sans Pro", "Source Sans Pro")
# Alternatively you can put all this in a CSV file with the same columns and
# then load it with read_csv()
# tasks <- read_csv("path/to/the/file")

# Read in data
# tasks = tribble(
#   ~Task,	                                        ~Start,	    ~End,	      ~Project,
#   "Theorie de decision",	                      "Q4/20", 	  "Q4/21",	  "Litterature Study",
#   "Machine Learning",	                          "Q1/21", 	  "Q1/22",	  "Litterature Study",
#   "Econometrie",	                              "Q1/21",    "Q1/22",	  "Litterature Study",
#   "Generation des données simulees",	          "Q2/21", 	  "Q2/22",	  "Data Collection",
#   "Collection des données experimentales",	      "Q4/21", 	  "Q4/22",	  "Data Collection",
#   "Èvaluation des performances",	              "Q3/21",    "Q1/23",	  "Application",
#   "Validation des théories",	                  "Q1/22", 	  "Q3/23",	  "Application",
#   "Redaction de la these",	                      "Q1/23",    "Q4/23",	  "Deliverables",
#   "Working paper 1",	                          "Q3/21",    "Q1/22",	  "Deliverables",
#   "Working paper 2",	                          "Q3/22",    "Q1/23",	  "Deliverables",
#   "Working paper 3",	                          "Q1/23",    "Q3/23",	  "Deliverables"
# )

tasks = tribble(
  ~Task,	                                        ~Start,	    ~End,	      ~Project,         ~Ordering,
  "Etude de la littérature",	                  "Q4/20", 	  "Q4/21",	  "Littérature",        "1",
  "Simulation des données",	                      "Q2/21", 	  "Q2/22",	  "Données",            "2",
  "Expérimentations Économiques (Plateforme)",    "Q1/22", 	  "Q4/22",	  "Données",            "2.6",
  "Èvaluation des pérformances",	              "Q3/21",    "Q3/23",	  "Application",        "3",
#   "Redaction de la thèse",	                      "Q1/23",    "Q4/23",	  "Deliverables",
#   "Working papers",	                              "Q3/21",    "Q1/22",	  "Deliverables",
#   "Working papers",	                              "Q3/22",    "Q1/23",	  "Deliverables",
#   "Working papers",	                              "Q1/23",    "Q3/23",	  "Deliverables",
  "Visite à Montréal (LID)",                      "Q4/21",    "Q1/22",    "Collaboration",      "2.5",
  "Formation à l'EPFL ou Leeds",                  "Q1/21",    "Q2/21",    "Collaboration",      "1.5"
)

# Convert data to long for ggplot
tasks.long <- tasks %>%
    mutate(
        Start = as.Date(
            as.yearqtr(Start, format = "Q%q/%y")
        ),
        End = as.Date(
            as.yearqtr(End, format = "Q%q/%y")
        )
    ) %>%
    gather(
        date.type, 
        task.date, 
        -c(Project, Task, Ordering)
    ) %>%
    arrange(
        Ordering,
        date.type,
        task.date
    ) %>%
    mutate(
        Task = factor(
            Task, 
            levels = rev(unique(Task)
        ), 
        ordered = TRUE)
    )
```

```{r ggplot2_gannt2, fig.showtext=TRUE, include = FALSE, warning=FALSE}
# Custom theme for making a clean Gantt chart
theme_gantt = function(
    base_size = 6.5, 
    base_family = "Source Sans Pro Light"
){
    ret = theme_bw(
        base_size, 
        base_family
    ) %+replace% theme(
        panel.background = element_rect(
            fill = "#ffffff", 
            colour = NA
        ),
        axis.title.x = element_text(
            vjust = -0.2
        ), 
        axis.title.y = element_text(
            vjust = 1.5
        ),
        title = element_text(
            vjust = 1.2, 
            family = "Source Sans Pro Semibold"
        ),
        panel.border = element_blank(), 
        axis.line = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_line(
            size = 0.5, 
            colour = "grey80"
        ),
        axis.ticks = element_blank(),
        legend.position = "bottom", 
        axis.title = element_text(
            size = rel(0.8), 
            family = "Source Sans Pro Semibold"
        ),
        strip.text = element_text(
            size = rel(1), 
            family = "Source Sans Pro Semibold"
        ),
        strip.background = element_rect(
            fill = "#ffffff", 
            colour = NA
        ),
        panel.spacing.y = unit(1.5, "lines"),
        legend.key = element_blank()
    )
    
    ret
}

# Calculate where to put the dotted lines that show up every three entries
x.breaks = seq(
    length(tasks$Task) + 0.5 - 3, 
    0, 
    by = -3
)

# Build plot
timeline = tasks.long %>% 
    arrange(
        Project,
        task.date
    ) %>% 
    ggplot( 
        aes(
            x = Task, 
            y = task.date, 
            colour = Project
        )
    ) + 
    geom_line(size = 4) + 
    geom_vline(
        xintercept = x.breaks, 
        colour = "grey80", 
        linetype = "dotted"
    ) + 
    guides(colour = guide_legend(title = NULL)) +
    labs(x = NULL, y = NULL) + 
    coord_flip() +
    scale_y_date(
        date_breaks = "2 months", 
        labels = date_format("%b ‘%y")
    ) +
    theme_gantt() + 
    theme(
        axis.text.x = element_text(angle = 45, hjust = 1)
    )
```

\hspace{-5cm}
```{r ggplo2_output, fig.showtext=TRUE, echo = FALSE, fig.cap = NULL, fig.height = 2.5, fig.width = 3.9, warning=FALSE, message=FALSE}
timeline
```

# Merci de votre attention

## Merci de votre attention 

\begin{center}
\textbf{\textit{Performances des modèles économétriques et de Machine Learning pour l'étude économique des choix discrets de consommation}}

Nikita Gusarov

\small Master 2
MIASHS C2ES (UGA)
\end{center}

\raggedright\small Directeur de thèse: 

\raggedright\hspace{10mm}\small Iragaël Joly, MCF HDR (GAEL, UGA, Grenoble INP)

\raggedright\small Co-encadrant:

\raggedright\hspace{10mm}\small Pierre Lemaire, MCF (G-SCOP, Grenoble INP)

## Références 

\tiny
<div id="refs"></div>
\normalsize

# Annexes 

## Econometrics against ML [@breiman2001stat]

<!-- Si besoin du temps - supprimer le  -->

\begin{figure}[hbtp]
\centering
\label{fig:parad}
\begin{subfigure}[c]{.4\linewidth}
    \centering
    \caption{Real world}
    \label{fig:parad1}
    \begin{tikzpicture}[box/.style = {draw, text width=1.5cm, align=center}]
        \node[box] (b) {Nature};
        \node[left=of b] (a) {$\mathcal{X}$};
        \node[right=of b] (c) {$\mathcal{Y}$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
    \end{tikzpicture}
\end{subfigure}\vspace{12pt}

\begin{subfigure}[c]{.3\textwidth}
    \centering
    \caption{Econometrics}
    \label{fig:parad2}
    \begin{tikzpicture}[box/.style = {draw, text width=1.8cm, align=center}]
        \node[box] (b) {\textcolor{red}{Theoretical\\model}};
        \node[left=of b] (a) {$X$};
        \node[right=of b] (c) {$Y$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
    \end{tikzpicture}
\end{subfigure}
\hfill
\begin{subfigure}[c]{.3\linewidth}
    \centering
    \caption{Machine learning}
    \label{fig:parad3}
    \begin{tikzpicture}[box/.style = {draw, text width=1.8cm, align=center}]
        \node[box] (b) {Nature};
        \node[box, below=of b] (d) {\textcolor{red}{ML\\model}};
        \node[left=of b] (a) {$X$};
        \node[right=of b] (c) {$Y$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
        \draw[->] (a) |- (d);
        \draw[->] (d) -| (c);
    \end{tikzpicture}
\end{subfigure}
\hspace{2cm}
\end{figure} 